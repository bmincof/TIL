# **테스트 코드의 구성**

기능은 주어진 상황에 따라 다르게 동작한다. 예를 들면, 정답이 각각 123, 456일 때 456을 예측한 경우 서로 다른 결과가 나와야한다. 이처럼 주어진 상황에 따라 기능 실행 결과는 달라진다. 이는 테스트 코드 구조에도 영향을 준다.

## **테스트 코드의 구성요소 : 상황, 실행, 결과 확인**

기능은 상황에 따라 결과가 달라진다. 테스트 코드는 기능을 실행하고 그 결과를 확인하므로 상황(given), 실행(when), 결과 확인(then)의 세 가지 요소로 테스트를 구성할 수 있다.

결과에 영향을 주는 상황이 없을 수도 있고 실행 결과가 리턴 값이 아니라 예외 발생인 경우도 있다.

상황-실행-결과 확인 구조가 테스트 코드를 작성하는데 도움을 주는 것은 맞지만 꼭 모든 테스트 메서드를 이 구조로 만들어야 하는 것은 아니므로 너무 집착하지는 말자.

# **외부 상황과 외부 결과**

상황 설정이 테스트 대상으로 국한된 것은 아니다. 상황에는 외부 요인도 있다. 예를 들면, 외부의 파일을 읽어오는 기능의 경우 파일이 존재하지 않을 수도 있다. 마찬가지로 테스트 대상이 아닌 외부에서 결과를 확인해야 할 때도 있다.

테스트는 실행할 때마다 동일한 결과를 보장해야 하므로 전처리를 통해 외부 상태에 영향을 받지 않고 같은 환경을 재현할 수 있도록 해야한다.

## **외부 상태가 테스트 결과에 영향을 주지 않게 하기**

테스트 코드는 TDD를 진행하는 동안 계속 실행하고 개발이 끝난 이후에도 반복적으로 테스트를 실행해서 문제가 없는지 검증한다. 따라서 테스트는 언제 실행해도 항상 정상적으로 동작하는 것이 중요하다. 가령 DB에 데이터를 추가해야할 때 데이터 중복으로 인한 의도하지 않은 테스트 실패를 피하려면, 테스트 실행 전에 외부를 원하는 상태로 만들거나 테스트 실행 후 외부 상태를 원래대로 돌려 놓아야 한다.

# **외부 상태와 테스트 어려움**

상황과 결과에 영향을 주는 외부 요인은 파일, DBMS, 외부 서버 등 다양하고 이런 외부 환경들을 테스트에 맞게 구성하는 것이 항상 가능한 것은 아니다. 외부 REST API 서버에서 응답을 받지 못하는 상황 등은 어떻게 만들어내서 테스트 해야할까?

테스트 대상이 아닌 외부 요인은 테스트 코드에서 다루기 힘들다. 테스트 대상과 결과에 외부 요인이 관여할 경우 대역을 사용하면 테스트 작성이 쉬워진다. 대역은 테스트 대상이 의존하는 대상의 실제 구현을 대신하는 구현체이다. 대역에는 다양한 종류가 존재하고 이들을 통해서 외부 상황이나 결과를 대체할 수 있다.
